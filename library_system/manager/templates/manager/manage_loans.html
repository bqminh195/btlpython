{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">

  <!-- TiÃªu Ä‘á» vÃ  nÃºt quay láº¡i -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary mb-0">ğŸ“– Quáº£n lÃ½ MÆ°á»£n SÃ¡ch</h2>
    <a href="{% url 'manager:manager_home' %}" class="btn btn-lg btn-outline-secondary shadow-sm px-4">
      â¬… Quay láº¡i
    </a>
  </div>

  <!-- Bá»™ lá»c -->
  <div class="card shadow-sm border-0 mb-4 rounded-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-5">
          <input type="text" name="q" class="form-control shadow-sm"
                 placeholder="ğŸ” TÃ¬m theo ngÆ°á»i dÃ¹ng hoáº·c tÃªn sÃ¡ch..."
                 value="{{ query }}">
        </div>
        <div class="col-md-4">
          <select name="status" class="form-select shadow-sm">
            <option value="">-- Táº¥t cáº£ tráº¡ng thÃ¡i --</option>
            <option value="overdue" {% if filter_status == 'overdue' %}selected{% endif %}>ğŸ“… QuÃ¡ háº¡n</option>
            <option value="ontime" {% if filter_status == 'ontime' %}selected{% endif %}>âœ… Äang trong háº¡n</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary w-100 shadow-sm">Lá»c</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Báº£ng dá»¯ liá»‡u -->
  <div class="table-responsive shadow-sm rounded-4 overflow-hidden">
    <table class="table align-middle text-center table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>NgÆ°á»i mÆ°á»£n</th>
          <th>TÃªn sÃ¡ch</th>
          <th>NgÃ y mÆ°á»£n</th>
          <th>Háº¡n tráº£</th>
          <th>NgÃ y tráº£</th>
          <th>Tráº¡ng thÃ¡i</th>
          <th>Thao tÃ¡c</th>
        </tr>
      </thead>
      <tbody>
        {% for loan in loans %}
        <tr
          {% if not loan.returned and loan.due_date < now %}
            class="table-danger"
          {% elif loan.returned %}
            class="table-success"
          {% else %}
            class="table-warning"
          {% endif %}
        >
          <td class="fw-semibold">{{ forloop.counter }}</td>
          <td>{{ loan.user.username }}</td>
          <td class="text-start">{{ loan.book.title }}</td>
          <td>{{ loan.borrowed_at|date:"d/m/Y" }}</td>
          <td>{{ loan.due_date|date:"d/m/Y" }}</td>
          <td>{% if loan.returned_at %}{{ loan.returned_at|date:"d/m/Y" }}{% else %}-{% endif %}</td>

          <td>
            {% if not loan.returned and loan.due_date < now %}
              <span class="badge bg-danger text-light px-3 py-2">â° QuÃ¡ háº¡n</span>
            {% elif loan.returned %}
              <span class="badge bg-success text-light px-3 py-2">âœ”ï¸ ÄÃ£ tráº£</span>
            {% else %}
              <span class="badge bg-warning text-dark px-3 py-2">ğŸ“š Äang mÆ°á»£n</span>
            {% endif %}
          </td>

          <td class="d-flex justify-content-center gap-2">
          <!-- NÃºt chá»‰nh sá»­a ngÃ y -->
          <a href="{% url 'manager:edit_loan_dates' loan.id %}" class="btn btn-outline-warning btn-sm rounded-pill shadow-sm">
            âœï¸ Sá»­a ngÃ y
          </a>

          <!-- NÃºt Ä‘Ã¡nh dáº¥u Ä‘Ã£ tráº£ -->
          {% if not loan.returned %}
          <a href="{% url 'manager:mark_returned' loan.id %}" class="btn btn-success btn-sm rounded-pill shadow-sm">
            âœ… ÄÃ£ tráº£
          </a>
          {% else %}
          <span class="text-muted fw-semibold">âœ”ï¸ HoÃ n táº¥t</span>
          {% endif %}
        </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center py-4 text-muted">KhÃ´ng cÃ³ phiáº¿u mÆ°á»£n nÃ o.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- PhÃ¢n trang -->
  {% if loans.has_other_pages %}
  <nav class="mt-4">
    <ul class="pagination justify-content-center">
      {% if loans.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ loans.previous_page_number }}">Â« TrÆ°á»›c</a>
      </li>
      {% endif %}
      {% for num in loans.paginator.page_range %}
      <li class="page-item {% if num == loans.number %}active{% endif %}">
        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
      </li>
      {% endfor %}
      {% if loans.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ loans.next_page_number }}">Sau Â»</a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>

<!-- CSS tinh chá»‰nh -->
<style>
  .table-hover tbody tr:hover {
    background-color: #f3f6fa !important;
    transition: all 0.2s ease-in-out;
  }

  .card {
    border-left: 5px solid #0d6efd;
  }

  .btn-outline-secondary:hover {
    background-color: #0d6efd;
    color: white;
  }

  .badge {
    font-size: 0.9rem;
  }
</style>
{% endblock %}
